function Banners(){}Banners.prototype.loadData=function(){var i=this;xfzajax.get({url:"/cms/banner_list/",success:function(n){if(200===n.code){var e=n.data;console.log(e);for(var a=0;a<e.length;a++){var t=e[a];i.createBannerItem(t)}}}})},Banners.prototype.createBannerItem=function(n){var e=this,a=template("banner-item",{banner:n}),t=$(".banner-list-group"),i=null;i=n?(t.append(a),t.find(".banner-item:last")):(t.prepend(a),t.find(".banner-item:first")),e.addImageSelectEvent(i),e.addRemoveBannerEvent(i),e.addSaveBannerEvent(i)},Banners.prototype.listenAddBannerEvent=function(){var n=this,e=$("#add-banner-btn");e.click(function(){6<=$(".banner-list-group").children().length?window.messageBox.showInfo("轮播图最多设置6张！"):n.createBannerItem()})},Banners.prototype.addImageSelectEvent=function(n){var o=n.find(".thumbnail"),e=n.find(".image-input");o.click(function(){e.click()}),e.change(function(){var r=this.files[0];xfzajax.get({url:"/cms/qntoken/",success:function(n){if(200===n.code){var e=n.data.token,a="lbt"+(new Date).getTime()+"."+r.name.split(".")[1],t={fname:a,params:{},mimeType:["image/png","image/jpeg","image/gif","video/x-ms-wmv"]},i={useCdnDomain:!0,retryCount:6,region:qiniu.region.z0};qiniu.upload(r,a,e,t,i).subscribe({next:function(n){var e=n.total.percent.toFixed(0)+"%";window.messageBox.showInfo("正在上传云服务器："+e+"%")},error:function(n){window.messageBox.showError(n.message)},complete:function(n){var e="http://q2ek62mau.bkt.clouddn.com/"+n.key;o.attr("src",e),window.messageBox.showSuccess("上传云服务器成功！")}})}}})})},Banners.prototype.addRemoveBannerEvent=function(e){e.find(".close-btn").click(function(){var n=e.attr("data-banner-id");n?xfzalert.alertConfirm({text:"您确定要删除这个轮播图吗?",confirmCallback:function(){xfzajax.post({url:"/cms/delete_banner/",data:{banner_id:n},success:function(n){200===n.code&&(e.remove(),window.messageBox.showSuccess("轮播图删除才成功！"))}})}}):e.remove()})},Banners.prototype.addSaveBannerEvent=function(t){var n=t.find(".save-btn"),i=t.find(".thumbnail"),r=t.find("input[name='priority']"),o=t.find("input[name='link_to']"),s=t.find('span[class="priority"]'),c=t.attr("data-banner-id"),d="";d=c?"/cms/edit_banner/":"/cms/add_banner/",n.click(function(){var n=i.attr("src"),e=r.val(),a=o.val();xfzajax.post({url:d,data:{image_url:n,priority:e,link_to:a,pk:c},success:function(n){200===n.code&&(c?window.messageBox.showSuccess("轮播图修改成功！"):(c=n.data.banner_id,t.attr("data-banner-id",c),window.messageBox.showSuccess("轮播图添加完成！")),s.text("优先级："+e))}})})},Banners.prototype.run=function(){this.listenAddBannerEvent(),this.loadData()},$(function(){(new Banners).run()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhbm5lcnMuanMiXSwibmFtZXMiOlsiQmFubmVycyIsInByb3RvdHlwZSIsImxvYWREYXRhIiwic2VsZiIsInRoaXMiLCJ4ZnphamF4IiwiZ2V0IiwidXJsIiwic3VjY2VzcyIsInJlc3VsdCIsImJhbm5lcnMiLCJjb25zb2xlIiwibG9nIiwiaSIsImxlbmd0aCIsImJhbm5lciIsImNyZWF0ZUJhbm5lckl0ZW0iLCJ0cGwiLCJ0ZW1wbGF0ZSIsImJhbm5lckxpc3RHcm91cCIsIiQiLCJiYW5uZXJJdGVtIiwiYXBwZW5kIiwiZmluZCIsInByZXBlbmQiLCJhZGRJbWFnZVNlbGVjdEV2ZW50IiwiYWRkUmVtb3ZlQmFubmVyRXZlbnQiLCJhZGRTYXZlQmFubmVyRXZlbnQiLCJsaXN0ZW5BZGRCYW5uZXJFdmVudCIsImFkZEJ0biIsImNsaWNrIiwiY2hpbGRyZW4iLCJ3aW5kb3ciLCJtZXNzYWdlQm94Iiwic2hvd0luZm8iLCJpbWFnZSIsImltYWdlSW5wdXQiLCJjaGFuZ2UiLCJmaWxlIiwiZmlsZXMiLCJ0b2tlbiIsImtleSIsIkRhdGUiLCJnZXRUaW1lIiwibmFtZSIsInNwbGl0IiwicHV0RXh0cmEiLCJmbmFtZSIsInBhcmFtcyIsIm1pbWVUeXBlIiwiY29uZmlnIiwidXNlQ2RuRG9tYWluIiwicmV0cnlDb3VudCIsInJlZ2lvbiIsInFpbml1IiwiejAiLCJ1cGxvYWQiLCJzdWJzY3JpYmUiLCJuZXh0IiwicmVzcG9uc2UiLCJwZXJjZW50VGV4dCIsInRvdGFsIiwicGVyY2VudCIsInRvRml4ZWQiLCJlcnJvciIsInNob3dFcnJvciIsIm1lc3NhZ2UiLCJjb21wbGV0ZSIsImF0dHIiLCJzaG93U3VjY2VzcyIsImJhbm5lcklkIiwieGZ6YWxlcnQiLCJhbGVydENvbmZpcm0iLCJ0ZXh0IiwiY29uZmlybUNhbGxiYWNrIiwicG9zdCIsImRhdGEiLCJiYW5uZXJfaWQiLCJyZW1vdmUiLCJzYXZlQnRuIiwiaW1hZ2VUYWciLCJwcmlvcml0eVRhZyIsImxpbmt0b1RhZyIsInByaW9yaXR5U3BhbiIsImltYWdlX3VybCIsInByaW9yaXR5IiwidmFsIiwibGlua190byIsInBrIiwicnVuIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTQSxXQUlUQSxRQUFRQyxVQUFVQyxTQUFXLFdBQ3pCLElBQUlDLEVBQU9DLEtBQ1hDLFFBQVFDLElBQUksQ0FDUkMsSUFBTyxvQkFDUEMsUUFBVyxTQUFVQyxHQUNqQixHQUFzQixNQUFuQkEsRUFBYSxLQUFVLENBQ3RCLElBQUlDLEVBQVVELEVBQWEsS0FDM0JFLFFBQVFDLElBQUlGLEdBQ1osSUFBSSxJQUFJRyxFQUFFLEVBQUdBLEVBQUVILEVBQVFJLE9BQVFELElBQUksQ0FDL0IsSUFBSUUsRUFBU0wsRUFBUUcsR0FDckJWLEVBQUthLGlCQUFpQkQsU0FPMUNmLFFBQVFDLFVBQVVlLGlCQUFtQixTQUFVRCxHQUMzQyxJQUFJWixFQUFPQyxLQUNQYSxFQUFNQyxTQUFTLGNBQWUsQ0FBQ0gsT0FBVUEsSUFDekNJLEVBQWtCQyxFQUFFLHNCQUVwQkMsRUFBYSxLQUliQSxFQUhETixHQUVDSSxFQUFnQkcsT0FBT0wsR0FDVkUsRUFBZ0JJLEtBQUssdUJBR2xDSixFQUFnQkssUUFBUVAsR0FDWEUsRUFBZ0JJLEtBQUssdUJBRXRDcEIsRUFBS3NCLG9CQUFvQkosR0FDekJsQixFQUFLdUIscUJBQXFCTCxHQUMxQmxCLEVBQUt3QixtQkFBbUJOLElBRzVCckIsUUFBUUMsVUFBVTJCLHFCQUF1QixXQUNyQyxJQUFJekIsRUFBT0MsS0FDUHlCLEVBQVNULEVBQUUsbUJBRWZTLEVBQU9DLE1BQU0sV0FEQyxHQUVHVixFQUFFLHNCQUFzQlcsV0FBV2pCLE9BRTVDa0IsT0FBT0MsV0FBV0MsU0FBUyxjQUcvQi9CLEVBQUthLHNCQUliaEIsUUFBUUMsVUFBVXdCLG9CQUFzQixTQUFTSixHQUM3QyxJQUFJYyxFQUFRZCxFQUFXRSxLQUFLLGNBQ3hCYSxFQUFhZixFQUFXRSxLQUFLLGdCQUdqQ1ksRUFBTUwsTUFBTSxXQUVSTSxFQUFXTixVQXNCZk0sRUFBV0MsT0FBTyxXQUNkLElBQUlDLEVBQU9sQyxLQUFLbUMsTUFBTSxHQUN0QmxDLFFBQVFDLElBQUksQ0FFUkMsSUFBTyxnQkFDUEMsUUFBVyxTQUFVQyxHQUNqQixHQUF1QixNQUFuQkEsRUFBYSxLQUFXLENBQ3hCLElBQUkrQixFQUFRL0IsRUFBYSxLQUFTLE1BQzlCZ0MsRUFBTSxPQUFRLElBQUtDLE1BQVFDLFVBQVksSUFBTUwsRUFBS00sS0FBS0MsTUFBTSxLQUFLLEdBQ2xFQyxFQUFXLENBQ1hDLE1BQU9OLEVBQ1BPLE9BQVEsR0FDUkMsU0FBVSxDQUFDLFlBQWEsYUFBYyxZQUFhLG1CQUVuREMsRUFBUyxDQUNUQyxjQUFjLEVBQ2RDLFdBQVksRUFDWkMsT0FBUUMsTUFBTUQsT0FBT0UsSUFFUkQsTUFBTUUsT0FBT2xCLEVBQU1HLEVBQUtELEVBQU9NLEVBQVVJLEdBRS9DTyxVQUFVLENBRWpCQyxLQUFRLFNBQVVDLEdBQ2QsSUFHSUMsRUFIUUQsRUFBU0UsTUFDREMsUUFFTUMsUUFBUSxHQUFLLElBQ3ZDL0IsT0FBT0MsV0FBV0MsU0FBUyxZQUFjMEIsRUFBYyxNQUczREksTUFBUyxTQUFVTCxHQUNmM0IsT0FBT0MsV0FBV2dDLFVBQVVOLEVBQVNPLFVBR3pDQyxTQUFZLFNBQVVSLEdBQ2xCLElBRUlwRCxFQUZTLG9DQUNFb0QsRUFBU2xCLElBRXhCTixFQUFNaUMsS0FBSyxNQUFPN0QsR0FDbEJ5QixPQUFPQyxXQUFXb0MsWUFBWSx1QkFTMURyRSxRQUFRQyxVQUFVeUIscUJBQXVCLFNBQVVMLEdBQ2hDQSxFQUFXRSxLQUFLLGNBQ3RCTyxNQUFNLFdBQ1gsSUFBSXdDLEVBQVdqRCxFQUFXK0MsS0FBSyxrQkFFNUJFLEVBQ0NDLFNBQVNDLGFBQWEsQ0FDbEJDLEtBQVEsZ0JBQ1JDLGdCQUFtQixXQUNmckUsUUFBUXNFLEtBQUssQ0FDVHBFLElBQU8sc0JBQ1BxRSxLQUFRLENBQ0pDLFVBQWFQLEdBRWpCOUQsUUFBVyxTQUFVQyxHQUNLLE1BQW5CQSxFQUFhLE9BQ1pZLEVBQVd5RCxTQUNYOUMsT0FBT0MsV0FBV29DLFlBQVksb0JBT2xEaEQsRUFBV3lELFlBS3ZCOUUsUUFBUUMsVUFBVTBCLG1CQUFxQixTQUFVTixHQUM3QyxJQUFJMEQsRUFBVTFELEVBQVdFLEtBQUssYUFDMUJ5RCxFQUFXM0QsRUFBV0UsS0FBSyxjQUMzQjBELEVBQWM1RCxFQUFXRSxLQUFLLDBCQUM5QjJELEVBQVk3RCxFQUFXRSxLQUFLLHlCQUM1QjRELEVBQWU5RCxFQUFXRSxLQUFLLDBCQUMvQitDLEVBQVdqRCxFQUFXK0MsS0FBSyxrQkFDM0I3RCxFQUFNLEdBRU5BLEVBREQrRCxFQUNPLG9CQUVBLG1CQUVWUyxFQUFRakQsTUFBTSxXQUNWLElBQUlzRCxFQUFZSixFQUFTWixLQUFLLE9BQzFCaUIsRUFBV0osRUFBWUssTUFDdkJDLEVBQVVMLEVBQVVJLE1BQ3hCakYsUUFBUXNFLEtBQUssQ0FDVHBFLElBQU9BLEVBQ1BxRSxLQUFPLENBQ0hRLFVBQWFBLEVBQ2JDLFNBQVlBLEVBQ1pFLFFBQVdBLEVBQ1hDLEdBQU1sQixHQUVWOUQsUUFBVyxTQUFVQyxHQUNLLE1BQW5CQSxFQUFhLE9BQ1Q2RCxFQUNDdEMsT0FBT0MsV0FBV29DLFlBQVksYUFLOUJDLEVBQVc3RCxFQUFhLEtBQWEsVUFFckNZLEVBQVcrQyxLQUFLLGlCQUFrQkUsR0FDbEN0QyxPQUFPQyxXQUFXb0MsWUFBWSxhQUVsQ2MsRUFBYVYsS0FBSyxPQUFTWSxVQU8vQ3JGLFFBQVFDLFVBQVV3RixJQUFNLFdBQ3BCckYsS0FBS3dCLHVCQUVMeEIsS0FBS0YsWUFHVGtCLEVBQUUsWUFDZ0IsSUFBSXBCLFNBQ1Z5RiIsImZpbGUiOiJiYW5uZXJzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIEJhbm5lcnMoKSB7XHJcblxyXG59XHJcblxyXG5CYW5uZXJzLnByb3RvdHlwZS5sb2FkRGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHhmemFqYXguZ2V0KHtcclxuICAgICAgICAndXJsJzogJy9jbXMvYmFubmVyX2xpc3QvJyxcclxuICAgICAgICAnc3VjY2Vzcyc6IGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgaWYocmVzdWx0Wydjb2RlJ10gPT09IDIwMCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmFubmVycyA9IHJlc3VsdFsnZGF0YSddO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYmFubmVycyk7XHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGk9MDsgaTxiYW5uZXJzLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYmFubmVyID0gYmFubmVyc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmNyZWF0ZUJhbm5lckl0ZW0oYmFubmVyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59O1xyXG5cclxuQmFubmVycy5wcm90b3R5cGUuY3JlYXRlQmFubmVySXRlbSA9IGZ1bmN0aW9uIChiYW5uZXIpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciB0cGwgPSB0ZW1wbGF0ZShcImJhbm5lci1pdGVtXCIsIHtcImJhbm5lclwiOiBiYW5uZXJ9KTtcclxuICAgIHZhciBiYW5uZXJMaXN0R3JvdXAgPSAkKFwiLmJhbm5lci1saXN0LWdyb3VwXCIpO1xyXG5cclxuICAgIHZhciBiYW5uZXJJdGVtID0gbnVsbDtcclxuICAgIGlmKGJhbm5lcil7XHJcbiAgICAgICAgLy8g5Yqg5Yiw5YiX6KGo5pyA5ZCOXHJcbiAgICAgICAgYmFubmVyTGlzdEdyb3VwLmFwcGVuZCh0cGwpO1xyXG4gICAgICAgIGJhbm5lckl0ZW0gPSBiYW5uZXJMaXN0R3JvdXAuZmluZChcIi5iYW5uZXItaXRlbTpsYXN0XCIpO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgLy8g5Yqg5Yiw5YiX6KGo5pyA5YmNXHJcbiAgICAgICAgYmFubmVyTGlzdEdyb3VwLnByZXBlbmQodHBsKTtcclxuICAgICAgICBiYW5uZXJJdGVtID0gYmFubmVyTGlzdEdyb3VwLmZpbmQoXCIuYmFubmVyLWl0ZW06Zmlyc3RcIik7XHJcbiAgICB9XHJcbiAgICBzZWxmLmFkZEltYWdlU2VsZWN0RXZlbnQoYmFubmVySXRlbSk7XHJcbiAgICBzZWxmLmFkZFJlbW92ZUJhbm5lckV2ZW50KGJhbm5lckl0ZW0pO1xyXG4gICAgc2VsZi5hZGRTYXZlQmFubmVyRXZlbnQoYmFubmVySXRlbSk7XHJcbn07XHJcblxyXG5CYW5uZXJzLnByb3RvdHlwZS5saXN0ZW5BZGRCYW5uZXJFdmVudCA9IGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICB2YXIgYWRkQnRuID0gJCgnI2FkZC1iYW5uZXItYnRuJyk7XHJcbiAgICB2YXIgbWF4X2xlbiA9IDY7XHJcbiAgICBhZGRCdG4uY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBsZW5ndGggPSAkKFwiLmJhbm5lci1saXN0LWdyb3VwXCIpLmNoaWxkcmVuKCkubGVuZ3RoO1xyXG4gICAgICAgIGlmIChsZW5ndGggPj0gbWF4X2xlbil7XHJcbiAgICAgICAgICAgIHdpbmRvdy5tZXNzYWdlQm94LnNob3dJbmZvKCfova7mkq3lm77mnIDlpJrorr7nva4nICsgbWF4X2xlbiArICflvKDvvIEnKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZWxmLmNyZWF0ZUJhbm5lckl0ZW0oKVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG5CYW5uZXJzLnByb3RvdHlwZS5hZGRJbWFnZVNlbGVjdEV2ZW50ID0gZnVuY3Rpb24oYmFubmVySXRlbSl7XHJcbiAgICB2YXIgaW1hZ2UgPSBiYW5uZXJJdGVtLmZpbmQoJy50aHVtYm5haWwnKTtcclxuICAgIHZhciBpbWFnZUlucHV0ID0gYmFubmVySXRlbS5maW5kKCcuaW1hZ2UtaW5wdXQnKTtcclxuICAgIC8vIOWbvueJh+aYr+S4jeiDveWkn+aJk+W8gOaWh+S7tumAieaLqeahhueahO+8jOWPquiDvemAmui/h2lucHV0W3R5cGU9J2ZpbGVd5qCH562+5omT5byAXHJcbiAgICAvLyDmiYDku6Xlj6/ku6XlnKjngrnlh7vlm77niYfnmoTml7blgJnojrflj5bliLDov5nkuKppbnB1dOagh+etvu+8jOaJi+WKqOiuvue9ruWwhuWFtuaJk+W8gFxyXG4gICAgaW1hZ2UuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vIOaJi+WKqOaJp+ihjOaJk+W8gOaWh+S7tui/meS4qmlucHV055qE54K55Ye75LqL5Lu2XHJcbiAgICAgICAgaW1hZ2VJbnB1dC5jbGljaygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gaW1hZ2VJbnB1dC5jaGFuZ2UoZnVuY3Rpb24gKCkge1xyXG4gICAgLy8gICAgIHZhciBmaWxlID0gdGhpcy5maWxlc1swXTtcclxuICAgIC8vICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgIC8vICAgICBmb3JtRGF0YS5hcHBlbmQoXCJmaWxlXCIsIGZpbGUpO1xyXG4gICAgLy8gICAgIHhmemFqYXgucG9zdCh7XHJcbiAgICAvLyAgICAgICAgIC8vIOS4iuS8oOiHs+acrOWcsFxyXG4gICAgLy8gICAgICAgICAndXJsJzogJy9jbXMvdXBsb2FkX2ZpbGUvJyxcclxuICAgIC8vICAgICAgICAgJ2RhdGEnOiBmb3JtRGF0YSxcclxuICAgIC8vICAgICAgICAgJ3Byb2Nlc3NEYXRhJzogZmFsc2UsXHJcbiAgICAvLyAgICAgICAgICdjb250ZW50VHlwZSc6IGZhbHNlLFxyXG4gICAgLy8gICAgICAgICAnc3VjY2Vzcyc6IGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgIC8vICAgICAgICAgICAgIGlmKHJlc3VsdFsnY29kZSddID09PSAyMDApe1xyXG4gICAgLy8gICAgICAgICAgICAgICAgIHZhciB1cmwgPSByZXN1bHRbJ2RhdGEnXVsndXJsJ107XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgaW1hZ2UuYXR0cignc3JjJywgdXJsKTtcclxuICAgIC8vICAgICAgICAgICAgIH1cclxuICAgIC8vICAgICAgICAgfVxyXG4gICAgLy8gICAgIH0pO1xyXG4gICAgLy8gfSk7XHJcblxyXG4gICAgaW1hZ2VJbnB1dC5jaGFuZ2UoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBmaWxlID0gdGhpcy5maWxlc1swXTtcclxuICAgICAgICB4ZnphamF4LmdldCh7XHJcbiAgICAgICAgICAgIC8vIOS4iuS8oOiHs+S4g+eJm+S6kVxyXG4gICAgICAgICAgICAndXJsJzogJy9jbXMvcW50b2tlbi8nLFxyXG4gICAgICAgICAgICAnc3VjY2Vzcyc6IGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHRbJ2NvZGUnXSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuID0gcmVzdWx0WydkYXRhJ11bJ3Rva2VuJ107XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9ICdsYnQnICsgKG5ldyBEYXRlKCkpLmdldFRpbWUoKSArICcuJyArIGZpbGUubmFtZS5zcGxpdCgnLicpWzFdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwdXRFeHRyYSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm5hbWU6IGtleSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7fSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWltZVR5cGU6IFsnaW1hZ2UvcG5nJywgJ2ltYWdlL2pwZWcnLCAnaW1hZ2UvZ2lmJywgJ3ZpZGVvL3gtbXMtd212J11cclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb25maWcgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZUNkbkRvbWFpbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0cnlDb3VudDogNixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uOiBxaW5pdS5yZWdpb24uejBcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvYnNlcnZhYmxlID0gcWluaXUudXBsb2FkKGZpbGUsIGtleSwgdG9rZW4sIHB1dEV4dHJhLCBjb25maWcpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOW8gOWni+S4iuS8oFxyXG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmFibGUuc3Vic2NyaWJlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5LiK5Lyg5pe26LCD55So55qE5Ye95pWw77yM5oyB57ut5ZGK6K+J5L2g6LCD55So5LqG5aSa5bCRXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICduZXh0JzogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG90YWwgPSByZXNwb25zZS50b3RhbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwZXJjZW50ID0gdG90YWwucGVyY2VudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRvRml4ZWTkv53nlZl45L2N5bCP5pWwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGVyY2VudFRleHQgPSBwZXJjZW50LnRvRml4ZWQoMCkgKyAnJSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubWVzc2FnZUJveC5zaG93SW5mbygn5q2j5Zyo5LiK5Lyg5LqR5pyN5Yqh5Zmo77yaJyArIHBlcmNlbnRUZXh0ICsgJyUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5LiK5Lyg5aSx6LSl6LCD55So55qE5Ye95pWwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdlcnJvcic6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm1lc3NhZ2VCb3guc2hvd0Vycm9yKHJlc3BvbnNlLm1lc3NhZ2UpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOS4iuS8oOWujOaIkOiwg+eUqOeahOWHveaVsFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnY29tcGxldGUnOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkb21haW4gPSAnaHR0cDovL3EyZWs2Mm1hdS5ia3QuY2xvdWRkbi5jb20vJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlbmFtZSA9IHJlc3BvbnNlLmtleTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSBkb21haW4gKyBmaWxlbmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlLmF0dHIoJ3NyYycsIHVybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubWVzc2FnZUJveC5zaG93U3VjY2Vzcygn5LiK5Lyg5LqR5pyN5Yqh5Zmo5oiQ5Yqf77yBJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9KTtcclxufTtcclxuXHJcbkJhbm5lcnMucHJvdG90eXBlLmFkZFJlbW92ZUJhbm5lckV2ZW50ID0gZnVuY3Rpb24gKGJhbm5lckl0ZW0pIHtcclxuICAgIHZhciBjbG9zZUJ0biA9IGJhbm5lckl0ZW0uZmluZCgnLmNsb3NlLWJ0bicpO1xyXG4gICAgY2xvc2VCdG4uY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBiYW5uZXJJZCA9IGJhbm5lckl0ZW0uYXR0cignZGF0YS1iYW5uZXItaWQnKTtcclxuICAgICAgICAvLyDlpoLmnpzmmK/ngrnliJvlu7rova7mkq3lm77mlrDliqDkuIrnmoTmmK/msqHmnIlkYXRhLWJhbm5lci1pZOi/meS4qmlk77yM6YKj5LmIYmFubmVySWTlsLHkuLrnqbpcclxuICAgICAgICBpZihiYW5uZXJJZCl7XHJcbiAgICAgICAgICAgIHhmemFsZXJ0LmFsZXJ0Q29uZmlybSh7XHJcbiAgICAgICAgICAgICAgICAndGV4dCc6ICfmgqjnoa7lrpropoHliKDpmaTov5nkuKrova7mkq3lm77lkJc/JyxcclxuICAgICAgICAgICAgICAgICdjb25maXJtQ2FsbGJhY2snOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeGZ6YWpheC5wb3N0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3VybCc6ICcvY21zL2RlbGV0ZV9iYW5uZXIvJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGEnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmFubmVyX2lkJzogYmFubmVySWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHRbJ2NvZGUnXSA9PT0gMjAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYW5uZXJJdGVtLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tZXNzYWdlQm94LnNob3dTdWNjZXNzKCfova7mkq3lm77liKDpmaTmiY3miJDlip/vvIEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgYmFubmVySXRlbS5yZW1vdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbkJhbm5lcnMucHJvdG90eXBlLmFkZFNhdmVCYW5uZXJFdmVudCA9IGZ1bmN0aW9uIChiYW5uZXJJdGVtKSB7XHJcbiAgICB2YXIgc2F2ZUJ0biA9IGJhbm5lckl0ZW0uZmluZCgnLnNhdmUtYnRuJyk7XHJcbiAgICB2YXIgaW1hZ2VUYWcgPSBiYW5uZXJJdGVtLmZpbmQoXCIudGh1bWJuYWlsXCIpO1xyXG4gICAgdmFyIHByaW9yaXR5VGFnID0gYmFubmVySXRlbS5maW5kKFwiaW5wdXRbbmFtZT0ncHJpb3JpdHknXVwiKTtcclxuICAgIHZhciBsaW5rdG9UYWcgPSBiYW5uZXJJdGVtLmZpbmQoXCJpbnB1dFtuYW1lPSdsaW5rX3RvJ11cIik7XHJcbiAgICB2YXIgcHJpb3JpdHlTcGFuID0gYmFubmVySXRlbS5maW5kKCdzcGFuW2NsYXNzPVwicHJpb3JpdHlcIl0nKTtcclxuICAgIHZhciBiYW5uZXJJZCA9IGJhbm5lckl0ZW0uYXR0cihcImRhdGEtYmFubmVyLWlkXCIpO1xyXG4gICAgdmFyIHVybCA9ICcnO1xyXG4gICAgaWYoYmFubmVySWQpe1xyXG4gICAgICAgIHVybCA9ICcvY21zL2VkaXRfYmFubmVyLyc7XHJcbiAgICB9ZWxzZXtcclxuICAgICAgICB1cmwgPSAnL2Ntcy9hZGRfYmFubmVyLyc7XHJcbiAgICB9XHJcbiAgICBzYXZlQnRuLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaW1hZ2VfdXJsID0gaW1hZ2VUYWcuYXR0cignc3JjJyk7XHJcbiAgICAgICAgdmFyIHByaW9yaXR5ID0gcHJpb3JpdHlUYWcudmFsKCk7XHJcbiAgICAgICAgdmFyIGxpbmtfdG8gPSBsaW5rdG9UYWcudmFsKCk7XHJcbiAgICAgICAgeGZ6YWpheC5wb3N0KHtcclxuICAgICAgICAgICAgJ3VybCc6IHVybCxcclxuICAgICAgICAgICAgJ2RhdGEnOntcclxuICAgICAgICAgICAgICAgICdpbWFnZV91cmwnOiBpbWFnZV91cmwsXHJcbiAgICAgICAgICAgICAgICAncHJpb3JpdHknOiBwcmlvcml0eSxcclxuICAgICAgICAgICAgICAgICdsaW5rX3RvJzogbGlua190byxcclxuICAgICAgICAgICAgICAgICdwayc6IGJhbm5lcklkXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdzdWNjZXNzJzogZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYocmVzdWx0Wydjb2RlJ10gPT09IDIwMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoYmFubmVySWQpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubWVzc2FnZUJveC5zaG93U3VjY2Vzcygn6L2u5pKt5Zu+5L+u5pS55oiQ5Yqf77yBJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHZhciBiYW5uZXJJZCA9IHJlc3VsdFsnZGF0YSddWydiYW5uZXJfaWQnXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5LiK6Z2i6L+Z56eN5YaZ5rOV5LiN6KGM77yM5Zug5Li6anPlj5jph4/kvZznlKjln5/mmK/lh73mlbDnuqfnmoTvvIzkvJrmiop2YXIgYmFubmVySWTlhYjmlL7lnKhcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5Ye95pWw5LiA5Y+l55qE5Zyw5pa55a6a5LmJ5oiQYmFubmVySWQgPSB1bmRlZmluZWTvvIzlm6DmraTkvJrmiorlpJbpnaLnmoRiYW5uZXJJZOe7meimhuebluaOiVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYW5uZXJJZCA9IHJlc3VsdFsnZGF0YSddWydiYW5uZXJfaWQnXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5a6M5oiQ5re75Yqg77yM5LiA5a6a6KaB5bCG6L+Z5LiqYmFubmVyLWl0ZW3orr7nva7kuIpkYXRhLWJhbm5lci1pZO+8jOS5i+WQjuaJjeiDveaJvuWIsOS/ruaUueWug++8gVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYW5uZXJJdGVtLmF0dHIoJ2RhdGEtYmFubmVyLWlkJywgYmFubmVySWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubWVzc2FnZUJveC5zaG93U3VjY2Vzcygn6L2u5pKt5Zu+5re75Yqg5a6M5oiQ77yBJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5U3Bhbi50ZXh0KFwi5LyY5YWI57qn77yaXCIgKyBwcmlvcml0eSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuQmFubmVycy5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5saXN0ZW5BZGRCYW5uZXJFdmVudCgpO1xyXG4gICAgLy8g5byC5q2l5Yqg6L296L2u5pKt5Zu+XHJcbiAgICB0aGlzLmxvYWREYXRhKCk7XHJcbn07XHJcblxyXG4kKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBiYW5uZXJzID0gbmV3IEJhbm5lcnMoKTtcclxuICAgIGJhbm5lcnMucnVuKCk7XHJcbn0pO1xyXG4iXX0=
